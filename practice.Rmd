---
title: "Optimization Practice"
author: "Will Townes"
date: "11/15/2017"
output: html_document
---

```{r}
library(ggplot2)
```

### Rosenbrock function, minimum is at (1,1)

```{r}
rosenbrock_f <- function(x){
  (1-x[1])^2 + 10*(x[2]-x[1]^2)^2
}
rosenbrock_g <- function(x){
  dx1<- -2*(1-x[1]) - 20*(x[2]-x[1]^2)*2*x[1]
  dx2<- 20*(x[2]-x[1]^2)
  c(dx1,dx2)
}
solution<-data.frame(x=1,y=1)

pd<-expand.grid(x=seq(0,3,.1),y=seq(0,6,.1))
pd$z<-apply(pd,1,rosenbrock_f)
ggplot(pd,aes(x=x,y=y))+geom_raster(aes(fill=log1p(z)))+scale_fill_continuous(low="red",high="blue")
(base_plot<-ggplot(pd)+geom_contour(aes(x=x,y=y,z=log1p(z)))+geom_point(data=solution,aes(x,y),colour="red",size=10,shape="x"))
```

simple gradient descent

```{r}
grad_descent<-function(f,g,x_init,stp=.001,maxIter=1000){
  delta<-100
  counter<-1
  res<-matrix(0,nrow=maxIter,ncol=3)
  colnames(res)<-c("x","y","f")
  res[1,]<-c(x_init,f(x_init))
  while(abs(delta)>1e-6 && counter<maxIter){
    counter<-counter+1
    grad<-g(res[counter-1,1:2])
    res[counter,1:2]<-res[counter-1,1:2]-stp*grad
    res[counter,3]<-f(res[counter,1:2])
    delta<-res[counter,3]-res[counter-1,3]
  }
  as.data.frame(res[1:counter,])
}
res<-list()
res[["gd"]]<-grad_descent(rosenbrock_f,rosenbrock_g,c(3,5))
base_plot+geom_path(aes(x=x,y=y),data=res$gd)
```

gradient descent with momentum

```{r}
momentum<-function(f,g,x_init,stp=.001,maxIter=1000,momentum=.9,wait=1){
  delta<-100
  counter<-1
  res<-matrix(0,nrow=maxIter,ncol=3)
  colnames(res)<-c("x","y","f")
  res[1,]<-c(x_init,f(x_init))
  velo<-0
  while(abs(delta)>1e-6 && counter<maxIter){
    counter<-counter+1
    if(counter<wait) velo<-0
    velo<-momentum*velo
    grad<-g(res[counter-1,1:2])
    velo<-velo+stp*grad
    res[counter,1:2]<-res[counter-1,1:2]-velo
    res[counter,3]<-f(res[counter,1:2])
    delta<-res[counter,3]-res[counter-1,3]
  }
  as.data.frame(res[1:counter,])
}
res[["mtm"]]<-momentum(rosenbrock_f,rosenbrock_g,c(3,5))
base_plot+geom_path(data=res$mtm,aes(x,y))
```

gradient descent with Nesterov momentum

```{r}
nesterov<-function(f,g,x_init,stp=.001,maxIter=1000,momentum=.9,wait=1){
  delta<-100
  counter<-1
  res<-matrix(0,nrow=maxIter,ncol=3)
  colnames(res)<-c("x","y","f")
  res[1,]<-c(x_init,f(x_init))
  velo<-0
  while(abs(delta)>1e-6 && counter<maxIter){
    counter<-counter+1
    if(counter<wait) velo<-0
    velo<-momentum*velo
    grad<-g(res[counter-1,1:2]-velo)
    velo<-velo+stp*grad
    res[counter,1:2]<-res[counter-1,1:2]-velo
    res[counter,3]<-f(res[counter,1:2])
    delta<-res[counter,3]-res[counter-1,3]
  }
  as.data.frame(res[1:counter,])
}
res[["nstv"]]<-nesterov(rosenbrock_f,rosenbrock_g,c(3,5))
base_plot+geom_path(data=res$nstv,aes(x,y))
```
